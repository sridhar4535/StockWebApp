<!DOCTYPE html>
<html lang="en">

<head>
    <title>Stock App</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.0/css/bootstrap-toggle.min.css" rel="stylesheet">
    <link href="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.0.1/css/bootstrap3/bootstrap-switch.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.0/js/bootstrap-toggle.min.js"></script>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.0.1/js/bootstrap-switch.js"></script>
    <script src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
    <script src="http://markitondemand.github.io/DataApis/StockQuoteSample/resources/QuoteService.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css">
    <script type="text/javascript">
        var loc, img, stock, desc;
        $(function() {
            $("#compname")
                .focus()
                .autocomplete({
                    source: function(request, response) {
                        $.ajax({
                            beforeSend: function() {
                                $("span.help-inline").show();
                                $("span.label-info").empty().hide();
                            },
                            url: "http://dev.markitondemand.com/api/v2/Lookup/jsonp",
                            dataType: "jsonp",
                            data: {
                                input: request.term
                            },
                            success: function(data) {
                                response($.map(data, function(item) {
                                    return {
                                        label: item.Name + " (" + item.Exchange + ")",
                                        value: item.Symbol
                                    }
                                }));
                                $("span.help-inline").hide();
                            }

                        });
                    },
                    minLength: 0,
                    select: function(event, ui) {
                        $("span.label-info").html("You selected " + ui.item.label).fadeIn("fast");
                    },
                    open: function() {
                        //$(this).removeClass("ui-corner-all").addClass("ui-corner-top");
                    },
                    close: function() {
                        //$(this).removeClass("ui-corner-top").addClass("ui-corner-all");
                    }
                });
        });



        $(document).ready(function() {

            var favorites = JSON.parse(localStorage.getItem('favorites')) || [];
            var tdata = JSON.parse(localStorage.getItem('tdata')) || ({});

            for (var i = 0; i < favorites.length; i++) {
                var sym = favorites[i];
                var name = tdata[sym][1];
                var lastprice = tdata[sym][2];
                var changper = tdata[sym][3];
                var markcap = tdata[sym][4];
                $('#fav > tbody:last').append('<tr id =' + sym + '><td><a id ="symlink" onclick="return theFunction(this);">' + sym + '</a></td><td>' + name + '</td><td>' + lastprice + '</td><td></td><td>' + markcap + '</td><td><button type="button" id= "del" onclick="return delFunction(' + sym + ');" class="btn btn-default"><span class="glyphicon glyphicon-trash"></span></button></td></tr>');
                if (changper.indexOf("-") > -1) {

                    document.getElementById(sym).cells.item(3).innerHTML = changper + '<img class="img-responsive" style="display:inline;" src="down.png"/>';
                    document.getElementById(sym).cells.item(3).style.color = "red";
                } else {
                    document.getElementById(sym).cells.item(3).innerHTML = changper + '<img class="img-responsive" style="display:inline;" src="up.png"/>';
                    document.getElementById(sym).cells.item(3).style.color = "green";
                }
            }

            $("#clear").click(function() {
                $('#next').prop('disabled', true);
                $("#myCarousel").carousel(0);
                $("#gly").addClass("disableClick");
                var p = document.getElementById("errorMes");
                if (p) {
                    p.parentNode.removeChild(p);
                }
                //validator.resetForm();
            });


            function refreshData(item) {
                var name, lastprice, changefinal, markcap, change, changeper, val;
                $.ajax({
                    url: 'http://stockapplication-1272.appspot.com/',
                    async: false,
                    data: "compname=" + item,
                    type: 'GET',
                    success: function(response) {
                        var obj = $.parseJSON(response);

                        if (jQuery.isEmptyObject(obj)) {
                            return false;
                        }

                        name = obj.Name;
                        lastprice = '$ ' + Math.round((obj.LastPrice) * 100) / 100;
                        change = Math.round((obj.Change) * 100) / 100;
                        changeper = Math.round((obj.ChangePercent) * 100) / 100;
                        changefinal = change + ' (' + changeper + '%)';
                        val = obj.MarketCap / 1000000000;
                        if (val > 0.01) {
                            markcap = (Math.round(val * 100) / 100 + "B");
                        } else {
                            markcap = (Math.round(val * 100) * 10 + "M");
                        }
                    }
                });
                return [lastprice, markcap, change, changeper];
            }

            var refreshIntervalId;

            $('#toggle_wrapper').click(function(e) {
                if (!$("#toggle-one").prop('checked')) {
                    refreshIntervalId = setInterval(function() {
                        var favorites = JSON.parse(localStorage.getItem('favorites')) || {};
                        for (var i in favorites) {
                            var data = refreshData(favorites[i]);
                            document.getElementById(favorites[i]).cells.item(2).innerHTML = data[0];
                            document.getElementById(favorites[i]).cells.item(4).innerHTML = data[1];

                            if (data[2] < 0 || data[3] < 0) {

                                document.getElementById(favorites[i]).cells.item(3).innerHTML = data[2] + ' (' + data[3] + '%)' + '<img class="img-responsive" style="display:inline;" src="down.png"/>';
                                document.getElementById(favorites[i]).cells.item(3).style.color = "red";
                            } else {
                                document.getElementById(favorites[i]).cells.item(3).innerHTML = data[2] + ' (' + data[3] + '%)' + '<img class="img-responsive" style="display:inline;" src="up.png"/>';
                                document.getElementById(favorites[i]).cells.item(3).style.color = "green";
                            }
                        }


                    }, 5000);
                } else {
                    clearInterval(refreshIntervalId);
                }
            });

            $("#refreshButton").click(function() {
                var favorites = JSON.parse(localStorage.getItem('favorites')) || {};
                for (var i in favorites) {
                    var data = refreshData(favorites[i]);
                    document.getElementById(favorites[i]).cells.item(2).innerHTML = data[0];
                    document.getElementById(favorites[i]).cells.item(4).innerHTML = data[1];
                }
            });

            var name, lastprice, changefinal, markcap, favorites, change, changeper;


            $("#compname").change(function() {
                var p = document.getElementById("errorMes");
                if (p) {
                    p.parentNode.removeChild(p);
                }
            });


            $("#carButton").click(function() {
                $('#next').prop('disabled', false);
                $(this).data('clicked', true);
                var favorites = JSON.parse(localStorage.getItem('favorites')) || [];
                if (favorites.indexOf($("#compname").val()) == -1) {
                    $('#star').css("color", "white");
                } else {
                    $('#star').css("color", "#FFF000");
                }

                var Markit = {};

                var ticker = $("#compname").val().toUpperCase();
                Markit.QuoteService = function(sSymbol, fCallback) {
                    this.symbol = sSymbol;
                    this.fCallback = fCallback;
                    this.DATA_SRC = "http://dev.markitondemand.com/Api/v2/Quote/jsonp";
                    this.makeRequest();
                };
                /**
                 * Ajax success callback. fCallback is the 2nd argument in the QuoteService constructor.
                 */
                Markit.QuoteService.prototype.handleSuccess = function(jsonResult) {
                    this.fCallback(jsonResult);
                };
                /**
                 * Ajax error callback
                 */
                Markit.QuoteService.prototype.handleError = function(jsonResult) {
                    console.error(jsonResult);
                };
                /** 
                 * Starts a new ajax request to the Quote API
                 */
                Markit.QuoteService.prototype.makeRequest = function() {
                    //Abort any open requests
                    if (this.xhr) {
                        this.xhr.abort();
                    }
                    //Start a new request
                    this.xhr = $.ajax({
                        data: {
                            symbol: this.symbol
                        },
                        url: this.DATA_SRC,
                        dataType: "jsonp",
                        success: this.handleSuccess,
                        error: this.handleError,
                        context: this
                    });
                };

                var present;

                if (ticker != "") {

                    new Markit.QuoteService(ticker, function(jsonResult) {

                        //Catch errors
                        if (!jsonResult || jsonResult.Message) {
                            var inpObj = document.getElementById("compname");
                            if (inpObj.checkValidity()) {
                                if (!$('#errorMes').length) {
                                    
                                    $("#logo").append('<p id = "errorMes" style="color:red;font-size: 12px; text-align:center;padding-left: 197px">Select a valid entry.</p>')
                
                                }
                            } else {
                                var p = document.getElementById("errorMes");
                                if (p) {
                                    p.parentNode.removeChild(p);
                                }

                            }
                        }
                    });
                }

            });


            $("#form").submit(function(event) {
                event.preventDefault();

                $.ajax({
                    url: 'http://stockapplication-1272.appspot.com/',
                    async: false,
                    data: $(form).serialize(),
                    type: 'GET',
                    success: function(response) {
                        var obj = $.parseJSON(response);

                        if (jQuery.isEmptyObject(obj)) {
                            return false;
                        }

                        name = obj.Name;
                        var symbol = obj.Symbol;
                        var favorites = JSON.parse(localStorage.getItem('favorites')) || [];
                        if (favorites.indexOf(symbol) > -1) {
                            $('#star').css("color", "#FFF000");
                        } else {
                            $('#star').css("color", "white");
                        }
                        lastprice = '$ ' + Math.round((obj.LastPrice) * 100) / 100;
                        change = Math.round((obj.Change) * 100) / 100;
                        changeper = Math.round((obj.ChangePercent) * 100) / 100;
                        changefinal = change + ' (' + changeper + '%)';
                        var time = formatDate(obj.Timestamp);
                        var val = obj.MarketCap / 1000000000;
                        if (val > 0.01) {
                            markcap = (Math.round(val * 100) / 100 + "B");
                        } else {
                            markcap = (Math.round(val * 100) * 10 + "M");
                        }
                        var volume = obj.Volume;
                        var changeytd = Math.round((obj.ChangeYTD) * 100) / 100;
                        var changeperytd = Math.round((obj.ChangePercentYTD) * 100) / 100;
                        var changeytdfinal = changeytd + ' (' + changeperytd + '%)';
                        var high = '$ ' + Math.round((obj.High) * 100) / 100;
                        var low = '$ ' + Math.round((obj.Low) * 100) / 100;
                        var open = '$ ' + Math.round((obj.Open) * 100) / 100;

                        loc = " Current Stock Price of " + name + " is " + lastprice;
                        desc = "Stock Information of " + name + " (" + symbol + ")";
                        img = "http://chart.finance.yahoo.com/t?s=" + symbol + "&lang=en-US&width=150&height=150";
                        stock = "LAST TRADE PRICE : " + lastprice + ", CHANGE: " + changefinal;
                        var dur = 1095;

                        $("#name").html(name);
                        $("#symbol").html(symbol);
                        $("#lastprice").html(lastprice);
                        $("#changefinal").html(changefinal);
                        if (change < 0 || changeper < 0) {
                            $("#changefinal").css('color', 'red');
                            $("#changefinal").append('<img class="img-responsive" style="display:inline;" src="down.png"/>');
                        } else {
                            $("#changefinal").css('color', 'green');
                            $("#changefinal").append('<img class="img-responsive" style="display:inline;" src="up.png"/>');
                        }
                        $("#time").html(time);
                        $("#markcap").html(markcap);
                        $("#volume").html(volume);
                        $("#changeytdfinal").html(changeytdfinal);
                        if (changeytd < 0 || changeperytd < 0) {
                            $("#changeytdfinal").css('color', 'red');
                            $("#changeytdfinal").append('<img class="img-responsive" style="display:inline;" src="down.png"/>');
                        } else {
                            $("#changeytdfinal").css('color', 'green');
                            $("#changeytdfinal").append('<img class="img-responsive" style="display:inline;" src="up.png"/>');
                        }
                        $("#high").html(high);
                        $("#low").html(low);
                        $("#open").html(open);



                        $(function() {
                            $('#map').html('<img class="img-responsive" src="http://chart.finance.yahoo.com/t?s=' + symbol + '&lang=en-US&width=500&height=400"/>');

                        });

                        $(function() {
                            if (typeof symbol !== 'undefined') {
                                new Markit.InteractiveChartApi(symbol, dur);
                            }
                        });

                        $(function() {
                            $("#myCarousel").carousel();
                            $("#myCarousel").carousel(1);
                        });

                        $(function() {
                            $.ajax({
                                url: 'https://ajax.googleapis.com/ajax/services/search/news?v=1.0&q=' + symbol + '&userip=216.58.192.17&callback=myjsonpfunction',
                                type: "GET",
                                dataType: 'jsonp',
                                jsonp: 'myjsonpfunction',
                                async: 'true',
                                success: function(data) {
                                    alert("success");
                                }
                            });
                        });

                    }
                });
            });

            $('#carButton').click(function() {
                $("#gly").removeClass("disableClick");
                $("#result>ul>li.active").removeClass("active");
                $("#currentstock").addClass("active");
                $("#current").addClass("active");
            });

            // register click event listener
            $('#star').click(function() {
                var favorites = JSON.parse(localStorage.getItem('favorites')) || [];
                var tdata = JSON.parse(localStorage.getItem('tdata')) || ({});
                var sym = symbol.innerHTML,
                    index = favorites.indexOf(sym);
                // item is not favorite
                if (index == -1) {
                    favorites.push(sym);
                    tdata[sym] = [sym, name, lastprice, changefinal, markcap]
                    $('#fav > tbody:last').append('<tr id =' + sym + '><td><a id ="symlink" onclick="return theFunction(this);">' + sym + '</a></td><td>' + name + '</td><td>' + lastprice + '</td><td></td><td>' + markcap + '</td><td><button type="button" id= "del" onclick="return delFunction(' + sym + ');" class="btn btn-default"><span class="glyphicon glyphicon-trash"></span></button></td></tr>');
                    if (change < 0 || changeper < 0) {

                        document.getElementById(sym).cells.item(3).innerHTML = change + ' (' + changeper + '%)' + '<img class="img-responsive" style="display:inline;" src="down.png"/>';
                        document.getElementById(sym).cells.item(3).style.color = "red";
                    } else {
                        document.getElementById(sym).cells.item(3).innerHTML = change + ' (' + changeper + '%)' + '<img class="img-responsive" style="display:inline;" src="up.png"/>';
                        document.getElementById(sym).cells.item(3).style.color = "green";
                    }
                    $('#star').css("color", "#FFF000");

                    // item is already favorite
                } else {
                    delete tdata[sym];
                    favorites.splice(index, 1);
                    $('table#fav tr#' + sym).remove();
                    $('#star').css("color", "white");
                }
                // store array in local storage
                localStorage.setItem('favorites', JSON.stringify(favorites));
                localStorage.setItem('tdata', JSON.stringify(tdata));
            });

        });


        var Markit = {};
        /**
         * Define the InteractiveChartApi.
         * First argument is symbol (string) for the quote. Examples: AAPL, MSFT, JNJ, GOOG.
         * Second argument is duration (int) for how many days of history to retrieve.
         */
        Markit.InteractiveChartApi = function(symbol, duration) {
            this.symbol = symbol.toUpperCase();
            this.duration = duration;
            this.PlotChart();
        };

        Markit.InteractiveChartApi.prototype.PlotChart = function() {

            var params = {
                parameters: JSON.stringify(this.getInputParams())
            }

            //Make JSON request for timeseries data
            $.ajax({
                beforeSend: function() {
                    $("#container").text("Loading chart...");
                },
                data: params,
                url: "http://dev.markitondemand.com/Api/v2/InteractiveChart/jsonp",
                dataType: "jsonp",
                context: this,
                success: function(json) {
                    //Catch errors
                    if (!json || json.Message) {
                        console.error("Error: ", json.Message);
                        return;
                    }
                    this.render(json);
                },
                error: function(response, txtStatus) {
                    console.log(response, txtStatus)
                }
            });
        };

        Markit.InteractiveChartApi.prototype.getInputParams = function() {
            return {
                Normalized: false,
                NumberOfDays: this.duration,
                DataPeriod: "Day",
                Elements: [{
                        Symbol: this.symbol,
                        Type: "price",
                        Params: ["ohlc"] //ohlc, c = close only
                    }, {
                        Symbol: this.symbol,
                        Type: "volume"
                    }]
                    //,LabelPeriod: 'Week',
                    //LabelInterval: 1
            }
        };

        Markit.InteractiveChartApi.prototype._fixDate = function(dateIn) {
            var dat = new Date(dateIn);
            return Date.UTC(dat.getFullYear(), dat.getMonth(), dat.getDate());
        };

        Markit.InteractiveChartApi.prototype._getOHLC = function(json) {
            var dates = json.Dates || [];
            var elements = json.Elements || [];
            var chartSeries = [];

            if (elements[0]) {

                for (var i = 0, datLen = dates.length; i < datLen; i++) {
                    var dat = this._fixDate(dates[i]);
                    var pointData = [
                        dat,
                        elements[0].DataSeries['open'].values[i],
                        elements[0].DataSeries['high'].values[i],
                        elements[0].DataSeries['low'].values[i],
                        elements[0].DataSeries['close'].values[i]
                    ];
                    chartSeries.push(pointData);
                };
            }
            return chartSeries;
        };

        Markit.InteractiveChartApi.prototype._getVolume = function(json) {
            var dates = json.Dates || [];
            var elements = json.Elements || [];
            var chartSeries = [];

            if (elements[1]) {

                for (var i = 0, datLen = dates.length; i < datLen; i++) {
                    var dat = this._fixDate(dates[i]);
                    var pointData = [
                        dat,
                        elements[1].DataSeries['volume'].values[i]
                    ];
                    chartSeries.push(pointData);
                };
            }
            return chartSeries;
        };

        Markit.InteractiveChartApi.prototype.render = function(data) {
            //console.log(data)
            // split the data set into ohlc and volume
            var ohlc = this._getOHLC(data),
                volume = this._getVolume(data);

            // set the allowed units for data grouping
            var groupingUnits = [
                [
                    'week', // unit name
                    [1] // allowed multiples
                ],
                [
                    'month', [1, 2, 3, 4, 6]
                ]
            ];

            // create the chart
            $("#rez").click(function() {
                setTimeout(function() {
                    $('#container').highcharts('StockChart', {

                        exporting: {
                            enabled: false
                        },

                        rangeSelector: {
                            selected: 1
                                //enabled: false
                        },

                        title: {
                            text: symbol.innerHTML + ' Stock Value'
                        },

                        yAxis: [{
                            title: {
                                text: 'Stock Value'
                            },
                            height: 200,
                            lineWidth: 2
                        }, {
                            title: {
                                text: ''
                            },
                            top: 300,
                            height: 100,
                            offset: 0,
                            lineWidth: 2
                        }],

                        series: [{
                            type: 'candlestick',
                            name: symbol.innerHTML,
                            data: ohlc,
                            type: 'area',
                            threshold: null,
                            tooltip: {
                                pointFormat: '<tr><td style="color: {series.color}">{series.name}: </td>' +
                                    '<td style="text-align: right"><b>$ {point.y}</b></td></tr>',
                                valueDecimals: 2
                            },
                            fillColor: {
                                linearGradient: {
                                    x1: 0,
                                    y1: 0,
                                    x2: 0,
                                    y2: 1
                                },
                                stops: [
                                    [0, Highcharts.getOptions().colors[0]],
                                    [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                                ]
                            }
                        }]
                    });
                }, 100);
            });
            
            $("#rezz").click(function() {
                setTimeout(function() {
                    $('#container').highcharts('StockChart', {

                        exporting: {
                            enabled: false
                        },

                        rangeSelector: {
                            selected: 1
                                //enabled: false
                        },

                        title: {
                            text: symbol.innerHTML + ' Stock Value'
                        },

                        yAxis: [{
                            title: {
                                text: 'Stock Value'
                            },
                            height: 200,
                            lineWidth: 2
                        }, {
                            title: {
                                text: ''
                            },
                            top: 300,
                            height: 100,
                            offset: 0,
                            lineWidth: 2
                        }],

                        series: [{
                            type: 'candlestick',
                            name: symbol.innerHTML,
                            data: ohlc,
                            type: 'area',
                            threshold: null,
                            tooltip: {
                                pointFormat: '<tr><td style="color: {series.color}">{series.name}: </td>' +
                                    '<td style="text-align: right"><b>$ {point.y}</b></td></tr>',
                                valueDecimals: 2
                            },
                            fillColor: {
                                linearGradient: {
                                    x1: 0,
                                    y1: 0,
                                    x2: 0,
                                    y2: 1
                                },
                                stops: [
                                    [0, Highcharts.getOptions().colors[0]],
                                    [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                                ]
                            }
                        }]
                    });
                }, 100);
            });
        };

        function fbShare() {
            FB.ui({
                    method: 'feed',
                    name: loc,
                    picture: img,
                    link: 'http://dev.markitondemand.com/',
                    caption: stock,
                    description: desc,
                    message: ''
                },
                function(response) {
                    if (response && response.post_id) {
                        alert('Posted successfully');
                    } else {
                        alert('Not posted');
                    }
                }

            );
        }


        function myjsonpfunction(data) {
            $('#newfe').html('');
            if (data.responseData != null) {
                $.each(data.responseData.results, function(i, rows) {
                    var panel = $('<div class="panel panel-default" id="pbody" />').appendTo('#newfe');
                    var body = $('<div class="panel-body" />').appendTo(panel);
                    body.append('<a href="' + rows.unescapedUrl + '">' + rows.title + '</a>');
                    body.append("</br>");
                    body.append("</br>");
                    body.append(rows.content);
                    body.append("</br>");
                    body.append("</br>");
                    body.append("<b>Publisher: " + rows.publisher + "</b>");
                    body.append("</br>");
                    body.append("</br>");
                    body.append("<b>Date: " + rows.publishedDate.substring(5, 25) + "</b>");
                    body.append("</br>");
                    body.append("</br>");
                    $("#newfe").append("</br");
                });
            } else {
                $('#newfe').html('');
            }
        }



        function delFunction(data) {
            var favorites = JSON.parse(localStorage.getItem('favorites')) || [];
            var tdata = JSON.parse(localStorage.getItem('tdata')) || ({});
            var sym = data.id;
            var index = favorites.indexOf(sym);
            delete tdata[sym];
            favorites.splice(index, 1);
            $('table#fav tr#' + sym).remove();
            localStorage.setItem('favorites', JSON.stringify(favorites));
            localStorage.setItem('tdata', JSON.stringify(tdata));
            $('#star').css("color", "white");

        }


        function formatDate(dateVal) {
            var monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];

            var newDate = new Date(dateVal);

            var sMonth = monthNames[newDate.getMonth()];
            var sDay = padValue(newDate.getDate());
            var sYear = newDate.getFullYear();
            var sHour = newDate.getHours();
            var sMinute = padValue(newDate.getMinutes());
            var sSeconds = padValue(newDate.getSeconds());
            var sAMPM = "am";

            var iHourCheck = parseInt(sHour);
            if(iHourCheck >= 12)
                sAMPM = "pm";
            if (iHourCheck > 12 ) {
                sHour = iHourCheck - 12;
            } else if (iHourCheck === 0) {
                sHour = "12";
            }

            sHour = padValue(sHour);

            return sDay + " " + sMonth + " " + sYear + ", " + sHour + ":" + sMinute + ":" + sSeconds + " " + sAMPM;
        }

        function padValue(value) {
            return (value < 10) ? "0" + value : value;
        }


        function theFunction(link) {
            $('#star').css("color", "#FFF000");
            $.ajax({
                url: 'http://stockapplication-1272.appspot.com/',
                async: false,
                data: "compname=" + link.text + "&carbutton=",
                type: 'GET',
                success: function(response) {
                    var obj = $.parseJSON(response);

                    if (jQuery.isEmptyObject(obj)) {
                        return false;
                    }

                    name = obj.Name;
                    var symbol = obj.Symbol;
                    lastprice = '$ ' + Math.round((obj.LastPrice) * 100) / 100;
                    var change = Math.round((obj.Change) * 100) / 100;
                    var changeper = Math.round((obj.ChangePercent) * 100) / 100;
                    changefinal = change + ' (' + changeper + '%)';
                    var time = formatDate(obj.Timestamp);
                    var val = obj.MarketCap / 1000000000;
                    if (val > 0.01) {
                        markcap = (Math.round(val * 100) / 100 + "B");
                    } else {
                        markcap = (Math.round(val * 100) * 10 + "M");
                    }
                    var volume = obj.Volume;
                    var changeytd = Math.round((obj.ChangeYTD) * 100) / 100;
                    var changeperytd = Math.round((obj.ChangePercentYTD) * 100) / 100;
                    var changeytdfinal = changeytd + ' (' + changeperytd + '%)';
                    var high = '$ ' + Math.round((obj.High) * 100) / 100;
                    var low = '$ ' + Math.round((obj.Low) * 100) / 100;
                    var open = '$ ' + Math.round((obj.Open) * 100) / 100;

                    loc = " Current Stock Price of " + name + " is " + lastprice;
                    stock = "Stock Information of " + name + " (" + symbol + ")";
                    img = "http://chart.finance.yahoo.com/t?s=" + symbol + "&lang=en-US&width=500&height=400";
                    desc = "LAST TRADE PRICE : " + lastprice + ", CHANGE: " + changefinal;
                    var dur = 1095;

                    $("#name").html(name);
                    $("#symbol").html(symbol);
                    $("#lastprice").html(lastprice);
                    $("#changefinal").html(changefinal);
                    if (change < 0 || changeper < 0) {
                        $("#changefinal").css('color', 'red');
                        $("#changefinal").append('<img class="img-responsive" style="display:inline;" src="down.png"/>');
                    } else {
                        $("#changefinal").css('color', 'green');
                        $("#changefinal").append('<img class="img-responsive" style="display:inline;" src="up.png"/>');
                    }
                    $("#time").html(time);
                    $("#markcap").html(markcap);
                    $("#volume").html(volume);
                    $("#changeytdfinal").html(changeytdfinal);
                    if (changeytd < 0 || changeperytd < 0) {
                        $("#changeytdfinal").css('color', 'red');
                        $("#changeytdfinal").append('<img class="img-responsive" style="display:inline;" src="down.png"/>');
                    } else {
                        $("#changeytdfinal").css('color', 'green');
                        $("#changeytdfinal").append('<img class="img-responsive" style="display:inline;" src="up.png"/>');
                    }
                    $("#high").html(high);
                    $("#low").html(low);
                    $("#open").html(open);



                    $(function() {
                        $('#map').html('<img class="img-responsive" src="http://chart.finance.yahoo.com/t?s=' + symbol + '&lang=en-US&width=500&height=400"/>');

                    });

                    $(function() {
                        if (typeof symbol !== 'undefined') {
                            new Markit.InteractiveChartApi(symbol, dur);
                        }
                    });
                    
                    $("#myCarousel").carousel();
                    $("#myCarousel").carousel(1);

                    $(function() {
                        $.ajax({
                            url: 'https://ajax.googleapis.com/ajax/services/search/news?v=1.0&q=' + symbol + '&userip=198.105.254.228&callback=myjsonpfunction',
                            type: "GET",
                            dataType: 'jsonp',
                            jsonp: 'myjsonpfunction',
                            async: 'true',
                            success: function(data) {
                                alert("success");
                            }
                        });
                    });

                }
            });
            $(function() {
                        $("#gly").removeClass("disableClick");
                        $("#result>ul>li.active").removeClass("active");
                        $("#currentstock").addClass("active");
                        $("#current").addClass("active");
                    });
        }

        // local storage stores strings so we use JSON to stringify for storage and parse to get out of storage
    </script>
    <style>
        .highcharts-input-group {
            display: none;
        }
        
        .col-md-8 {
            width: 73%;
        }
        
        label.error {
            display: none;
        }
        
        hr {
            border: 0;
            height: 1px;
            background: #ddd;
        }
        
        #outer.panel-body {
            background: #215779;
        }
        
        thead {
            background-color: #f5f5f5;
        }
        
        #table .table-striped>tbody>tr:nth-of-type(even) {
            background-color: #f9f9f9;
        }
        
        #table .table-striped>tbody>tr:nth-of-type(odd) {
            background-color: white;
        }
        
        .carousel-control.left,
        .carousel-control.right {
            background-image: none;
            outline: none;
        }
        
        .carousel-control {
            position: relative;
        }
        
        .nav-pills a,
        .nav-pills a:hover,
        .nav-pills a:focus {
            outline: 0;
        }
        
        #pbody .panel-body {
            background: #f5f5f5;
        }
        
        #table th {
            border: 0px !important;
        }
        
        .btn-default {
            background-color: #F8F8F8 !important;
        }
        
        html,
        body {
            background-color: #215779;
        }
        
        .disableClick {
            pointer-events: none;
        }
        a {cursor: pointer;}
        @media only screen and (max-width : 480px){
             #favlist{
                 width: 45%;
             }
            
            #sto{
                 width: 40%;
             }
             
             #get {
                 text-align: left !important;
            }
            
            #pow {
                 text-align: left !important;
            }
            
            #errorMes {
                text-align:left !important;
                padding-left: 0px !important;
            }
        }
    </style>
</head>

<body>
    <script>
        window.fbAsyncInit = function() {
            FB.init({
                appId: '1509611739345496',
                xfbml: true,
                version: 'v2.5'
            });
        };

        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {
                return;
            }
            js = d.createElement(s);
            js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>
    <div class="container">
        </br>
        <div class="panel panel-default">
            <div class="panel-body">
                <h4 align="center">Stock Market Search</h4>
                <form class="form-horizontal" id="form" method="post">
                    <div class="row">
                        <div class="col-md-4">
                            <label for="companyname">Enter the stock name or symbol:
                        <span style="color: red;">*</span>
                        </label>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <div class="text-left">
                                    <input type="text" class="form-control" required x-moz-errormessage="Please enter a Company Name or Symbol!" name="compname" id="compname" placeholder="Apple Inc or APPL">
                                </div>
                            </div>
                        </div>
                        <div  class="col-md-3">
                            <div id="get" class="text-right">
                                <button type="submit" name="carbutton" id="carButton" class="btn btn-primary">
                           <span class="glyphicon glyphicon-search"></span>Get Quote
                           </button>
                                <button type="reset" class="btn btn-default" id="clear">
                           <span class="glyphicon glyphicon-refresh"></span> Clear
                           </button>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="row">
                    <div class="col-md-7">
                        <div id="logo"></div>
                    </div>
                    <div class="col-md-4">
                        <div id="pow" class="text-right">
                            <label id="pow" for="forecastLogo">Powered By:</label>
                            <a href="http://dev.markitondemand.com/MODApis/"><img style="width: 100px; height: 20px;" src="mod-logo.png" alt="Markit On Demand logo"></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr style="">
        <div class="panel panel-default">
            <div class="panel-body">
                <div id="myCarousel" class="carousel slide" data-ride="carousel" data-interval="false">
                    <!-- Wrapper for slides -->
                    <div class="carousel-inner" role="listbox">
                        <div class="item active">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div id="favlist" class="col-md-8 col-xs-2">
                                        <b>Favorite List</b>
                                    </div>
                                    <span class = "hidden-xs">Automatic Refresh:</span>
                                        <span id="toggle_wrapper">
                                 <label class="checkbox-inline">
                                 <input type="checkbox" data-toggle = "toggle" id="toggle-one">
                                 </label>  
                                 </span>
                                        <button id="refreshButton" type="button" class="btn btn-default">
                                 <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>
                                 </button>
                                        <a id="gly" class="right carousel-control disableClick" href="#myCarousel" role="button" data-slide="next">
                                            <button type="button" id="next" disabled=true class="btn btn-default">
                                 <span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span>
                                 <span class="sr-only">Next</span>
                                 </button>
                                        </a>
                                </div>
                                <div class="panel-body">
                                    <div id="table" class="table-responsive">
                                        <table id="fav" class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Symbol</th>
                                                    <th>Company Name</th>
                                                    <th>Stock Price</th>
                                                    <th>Change (Change Percent)</th>
                                                    <th>Market Cap</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="container-fluid panel-container">
                                        <div class="col-xs-3 text-left">
                                            <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev" data-interval="false">
                                                <button type="button" class="btn btn-default">
                                    <span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                    </button>
                                            </a>
                                        </div>
                                        <div class="col-xs-6 text-center ">
                                            <div><b>Stock Details</b></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <div id="result">
                                        <ul class="nav nav-pills">
                                            <li id="current" class="active"><a data-toggle="pill" href="#currentstock"><span class="glyphicon glyphicon-dashboard"></span><span class = "hidden-xs"> Current</span> Stock</a></li>
                                            <li id="rez"><a data-toggle="pill" href="#histcha"><span class="glyphicon glyphicon-stats"></span><span class = "hidden-xs"> Historical</span> Charts</a></li>
                                            <li><a data-toggle="pill" href="#newfe"><span class="glyphicon glyphicon-link"></span> News<span class = "hidden-xs"> Feeds</span></a></li>
                                            </ul></span>
                                        
                                        <div class="row">
                                            <div class="col-md-12">
                                                <hr style="color: black; padding-bottom: 2px;">
                                            </div>
                                        </div>
                                        <div id="my-tab-content responsive" class="tab-content">
                                            <div class="tab-pane active" id="currentstock">
                                                <div class="row">
                                                        <div id="sto" class="col-md-8 col-xs-2 text-left">
                                                            <b>Stock Details</b>
                                                        </div>
                                                        <div class="col-md-3 text-right">
                                                            <img onclick="fbShare()" src="fb.png" height="55px" width="55px">
                                                            <button type="button" id="star" class="btn btn-default btn-lg">
                                                                   <span class="glyphicon glyphicon-star"></span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </br>
                                                <div class="row no-gutter" style="padding-left:0;">
                                                    <div class="col-md-6">
                                                        <!-- left pane on tab 1 -->
                                                        <div class="row no-gutter" id="TabOneTop">
                                                            <div class="col-md-6">
                                                                <!-- Tab 1 image -->
                                                                <div class="text-center">
                                                                    <div id="TabOneImage" style="background-color:#FF9999"></div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <!-- Tab 1 temperature display -->
                                                                <div style="background-color: #FF9999">
                                                                    <div class="row">
                                                                        <div class="text-center">
                                                                            <div class="col-xs-12 col-md-12" id="TabOneTempDisplay">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row" id="TabOneBottom" style="margin-top:20px;">
                                                            <div class="col-md-12" id="TabOneTable" style="margin-top:-30px;">
                                                                <!-- Tab 1 table -->
                                                                <table style="background-color: white;" class="table table-striped" id="table">
                                                                    <tr>
                                                                        <td>Name</td>
                                                                        <td id="name"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Symbol</td>
                                                                        <td id="symbol"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Last Price</td>
                                                                        <td id="lastprice"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Change(Change Percent)</td>
                                                                        <td id="changefinal"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Time and Date</td>
                                                                        <td id="time"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Market Cap</td>
                                                                        <td id="markcap"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Volume</td>
                                                                        <td id="volume"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Change YTD(Change Precent YTD)</td>
                                                                        <td id="changeytdfinal"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>High Price</td>
                                                                        <td id="high"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Low Price</td>
                                                                        <td id="low"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Opening Price</td>
                                                                        <td id="open"></td>
                                                                    </tr>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                <div id="map" style="height: 516px; width: auto; border:solid 1px; border-color:white;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tab-pane" id="histcha">
                                                <div id="container"></div>
                                            </div>
                                            <div class="tab-pane" id="newfe">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>